"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8046],{3905:(e,a,t)=>{t.d(a,{Zo:()=>p,kt:()=>k});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),u=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},p=function(e){var a=u(e.components);return n.createElement(s.Provider,{value:a},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=u(t),d=r,k=c["".concat(s,".").concat(d)]||c[d]||m[d]||o;return t?n.createElement(k,l(l({ref:a},p),{},{components:t})):n.createElement(k,l({ref:a},p))}));function k(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=d;var i={};for(var s in a)hasOwnProperty.call(a,s)&&(i[s]=a[s]);i.originalType=e,i[c]="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=t[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},19445:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var n=t(87462),r=(t(67294),t(3905));const o={},l="Documenta\xe7\xe3o - Integra\xe7\xe3o CUSTOMERS B2B SK",i={unversionedId:"Processos/custumers_b2b_sk",id:"Processos/custumers_b2b_sk",title:"Documenta\xe7\xe3o - Integra\xe7\xe3o CUSTOMERS B2B SK",description:"Vis\xe3o Geral",source:"@site/docs/5-Processos/custumers_b2b_sk.md",sourceDirName:"5-Processos",slug:"/Processos/custumers_b2b_sk",permalink:"/docushark/docs/Processos/custumers_b2b_sk",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Acerto de Custo Kardex",permalink:"/docushark/docs/Processos/acerto_de_custo"},next:{title:"Fechamento de estoque",permalink:"/docushark/docs/Processos/fechamento_estoque"}},s={},u=[{value:"Vis\xe3o Geral",id:"vis\xe3o-geral",level:2},{value:"Estrutura do Projeto",id:"estrutura-do-projeto",level:2},{value:"User Function Principal",id:"user-function-principal",level:3},{value:"L\xf3gica de Hor\xe1rio de Processamento",id:"l\xf3gica-de-hor\xe1rio-de-processamento",level:2},{value:"Fun\xe7\xe3o de Atualiza\xe7\xe3o - AtualizaCustomers()",id:"fun\xe7\xe3o-de-atualiza\xe7\xe3o---atualizacustomers",level:2},{value:"Query Principal",id:"query-principal",level:3},{value:"Campos Atualizados na <code>ZYD090</code>",id:"campos-atualizados-na-zyd090",level:3},{value:"Configura\xe7\xf5es T\xe9cnicas",id:"configura\xe7\xf5es-t\xe9cnicas",level:2},{value:"Fluxo de Processamento",id:"fluxo-de-processamento",level:2},{value:"Execu\xe7\xe3o",id:"execu\xe7\xe3o",level:2}],p={toc:u};function c(e){let{components:a,...t}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"documenta\xe7\xe3o---integra\xe7\xe3o-customers-b2b-sk"},"Documenta\xe7\xe3o - Integra\xe7\xe3o CUSTOMERS B2B SK"),(0,r.kt)("h2",{id:"vis\xe3o-geral"},"Vis\xe3o Geral"),(0,r.kt)("p",null,"Integra\xe7\xe3o para atualiza\xe7\xe3o de clientes no ambiente B2B com processamento diferenciado por hor\xe1rio comercial."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"estrutura-do-projeto"},"Estrutura do Projeto"),(0,r.kt)("h3",{id:"user-function-principal"},"User Function Principal"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"U_EnvDicB2B(aParam)"),(0,r.kt)("br",{parentName:"p"}),"\n","Fun\xe7\xe3o principal que orquestra o processamento dos dicion\xe1rios."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Par\xe2metros")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"aParam"),": Array com c\xf3digo da empresa e filial (padr\xe3o: ",(0,r.kt)("inlineCode",{parentName:"li"},'{"09","01"}'),")")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Dicion\xe1rios Processados")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-advpl"},'aDicionarios := {\n    "STATE",\n    "CITY",\n    "COMPANY",\n    "PAYMENT_CONDITION",\n    "SELLER",\n    "PRICE_TABLE",\n    "DELIVERY_TYPE",\n    "TRANSACTION_TYPE",\n    "CUSTOMER_TYPE",\n    "CUSTOMERS"\n}\n')),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"l\xf3gica-de-hor\xe1rio-de-processamento"},"L\xf3gica de Hor\xe1rio de Processamento"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Hor\xe1rio Comercial (08:00 - 21:00, Segunda a S\xe1bado)")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Processa ",(0,r.kt)("strong",{parentName:"li"},"APENAS")," dicion\xe1rio ",(0,r.kt)("inlineCode",{parentName:"li"},"CUSTOMERS")),(0,r.kt)("li",{parentName:"ul"},"Executa atualiza\xe7\xe3o espec\xedfica via ",(0,r.kt)("inlineCode",{parentName:"li"},"AtualizaCustomers()")),(0,r.kt)("li",{parentName:"ul"},"Chama ",(0,r.kt)("inlineCode",{parentName:"li"},'ProcessDic("CUSTOMERS")'))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Fora do Hor\xe1rio Comercial")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Processa ",(0,r.kt)("strong",{parentName:"li"},"TODOS")," os dicion\xe1rios normalmente"),(0,r.kt)("li",{parentName:"ul"},"Inclui o job das 22:00 que processa integralmente")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"fun\xe7\xe3o-de-atualiza\xe7\xe3o---atualizacustomers"},"Fun\xe7\xe3o de Atualiza\xe7\xe3o - AtualizaCustomers()"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Objetivo"),(0,r.kt)("br",{parentName:"p"}),"\n","Atualiza registros na tabela ",(0,r.kt)("inlineCode",{parentName:"p"},"ZYD090")," com status ",(0,r.kt)("inlineCode",{parentName:"p"},'"N"')," para clientes modificados."),(0,r.kt)("h3",{id:"query-principal"},"Query Principal"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"WITH CTE_CLIENTES AS (\n    SELECT\n        A1.A1_COD        AS COD,\n        A1.A1_LOJA       AS LOJA,\n        A1.A1_NOME       AS NOME,\n        A1.S_T_A_M_P_    AS STAMP,\n        YD.ZYD_IDREG     AS IDREG,\n        YD.ZYD_DTINT     AS DT_INT,\n        YD.ZYD_HORA      AS HR_INT,\n        ('20' || SUBSTR(A1.S_T_A_M_P_,7,2) ||\n         SUBSTR(A1.S_T_A_M_P_,4,2) ||\n         SUBSTR(A1.S_T_A_M_P_,1,2)) AS DT_ALTERACAO,\n        CASE\n            WHEN TO_NUMBER(SUBSTR(A1.S_T_A_M_P_,10,2)) >= 3 THEN\n                LPAD(TO_CHAR(TO_NUMBER(SUBSTR(A1.S_T_A_M_P_,10,2)) - 3),2,'0') ||\n                SUBSTR(A1.S_T_A_M_P_,12,6)\n            ELSE\n                LPAD(TO_CHAR(TO_NUMBER(SUBSTR(A1.S_T_A_M_P_,10,2)) + 21),2,'0') ||\n                SUBSTR(A1.S_T_A_M_P_,12,6)\n        END AS HR_ALTERACAO\n    FROM SA1090 A1\n    INNER JOIN SZ9090 Z9 ON A1.A1_COD = Z9.Z9_CLIENTE AND Z9.D_E_L_E_T_ = ' '\n    LEFT JOIN ZYD090 YD ON YD.ZYD_IDREG = A1.A1_COD || A1.A1_LOJA\n        AND YD.D_E_L_E_T_ = ' '\n        AND YD.ZYD_INTERF = 'CUSTOMERS'\n        AND YD.ZYD_STATUS = 'S'\n    WHERE\n        A1.D_E_L_E_T_ = ' '\n        AND A1.A1_FILIAL = ' '\n        AND A1.A1_COD <> 'LJ0001'\n        AND A1.A1_XEMPGRU <> '1'\n        AND (A1.A1_COD, A1.A1_LOJA) IN (\n            SELECT ZD.ZD_CODIGO, ZD.ZD_LOJA\n            FROM SZD090 ZD\n            WHERE ZD.D_E_L_E_T_ = ' '\n        )\n)\nSELECT\n    COD,\n    LOJA,\n    NOME,\n    DT_INT,\n    HR_INT,\n    DT_ALTERACAO,\n    HR_ALTERACAO\nFROM CTE_CLIENTES\nWHERE IDREG IS NULL\n   OR (DT_ALTERACAO > DT_INT OR (DT_ALTERACAO = DT_INT AND HR_ALTERACAO > HR_INT))\nORDER BY COD, LOJA\n")),(0,r.kt)("h3",{id:"campos-atualizados-na-zyd090"},"Campos Atualizados na ",(0,r.kt)("inlineCode",{parentName:"h3"},"ZYD090")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZYD_DTALT"),": Data da altera\xe7\xe3o (",(0,r.kt)("inlineCode",{parentName:"li"},"FwTimeUF('SP')[1]"),")"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZYD_STATUS"),": Status atualizado para ",(0,r.kt)("inlineCode",{parentName:"li"},'"N"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ZYD_ERRO"),": Limpa o campo de erro")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"configura\xe7\xf5es-t\xe9cnicas"},"Configura\xe7\xf5es T\xe9cnicas"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Chave de Busca na ZYD")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-advpl"},'cChaveBusca := FWxFilial("ZYD") + ;\n               PadR("CUSTOMERS", TamSX3("ZYD_INTERF")[1]) + ;\n               PadR(cIdReg, TamSX3("ZYD_IDREG")[1])\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\xcdndice Utilizado")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\xcdndice 1 da tabela ",(0,r.kt)("inlineCode",{parentName:"li"},"ZYD090"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Fun\xe7\xf5es de Apoio")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"MPSysOpenQuery()"),": Execu\xe7\xe3o de queries"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"FwTimeUF('SP')[1]"),": Data atual SP"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"RetSqlName()"),": Retorna nome SQL das tabelas")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"fluxo-de-processamento"},"Fluxo de Processamento"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Valida\xe7\xe3o Inicial")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Verifica ambiente RPC"),(0,r.kt)("li",{parentName:"ul"},"Checa registros pendentes com ",(0,r.kt)("inlineCode",{parentName:"li"},"RegPendentes()")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Processamento por Dicion\xe1rio")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Loop atrav\xe9s de ",(0,r.kt)("inlineCode",{parentName:"li"},"aDicionarios")),(0,r.kt)("li",{parentName:"ul"},"Aplica l\xf3gica de hor\xe1rio comercial"),(0,r.kt)("li",{parentName:"ul"},"Processa espec\xedfico para ",(0,r.kt)("inlineCode",{parentName:"li"},"CUSTOMERS")," ou geral"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Atualiza\xe7\xe3o em Lote")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Identifica registros modificados"),(0,r.kt)("li",{parentName:"ul"},"Atualiza status para ",(0,r.kt)("inlineCode",{parentName:"li"},'"N"')),(0,r.kt)("li",{parentName:"ul"},"Mant\xe9m m\xe9tricas de performance")))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"execu\xe7\xe3o"},"Execu\xe7\xe3o"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Chamada da Function")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-advpl"},"U_EnvDicB2B()\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Job Autom\xe1tico")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Configurado para executar \xe0s 22:00"),(0,r.kt)("li",{parentName:"ul"},"Processa todos os dicion\xe1rios"),(0,r.kt)("li",{parentName:"ul"},"Durante o dia processa apenas ",(0,r.kt)("inlineCode",{parentName:"li"},"CUSTOMERS"))),(0,r.kt)("hr",null))}c.isMDXComponent=!0}}]);